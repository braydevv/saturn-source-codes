<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
  <title>Stand on the right color, Robby! (Simple Version)</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background-color: #000;
    }
    
    #unity-container {
      width: 100%;
      height: 100%;
    }
    
    #unity-canvas {
      width: 100%;
      height: 100%;
      background: url('background.jpeg') center / cover;
    }
    
    #unity-loading-bar {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    #unity-logo {
      width: 154px;
      height: 130px;
      background: url('logo.png') no-repeat center;
      margin-bottom: 10px;
    }
    
    #unity-progress-bar-empty {
      width: 141px;
      height: 18px;
      margin-top: 10px;
      background: url('TemplateData/progress-bar-empty-dark.png') no-repeat center;
    }
    
    #unity-progress-bar-full {
      width: 0%;
      height: 18px;
      margin-top: 10px;
      background: url('TemplateData/progress-bar-full-dark.png') no-repeat center;
    }
    
    .spinner {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 50px;
      height: 50px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: translate(-50%, -50%) rotate(360deg); }
    }
  </style>
</head>
<body>
  <div id="unity-container">
    <canvas id="unity-canvas"></canvas>
    <div id="unity-loading-bar">
      <div id="unity-logo"></div>
      <div id="unity-progress-bar-empty" style="display: none;">
        <div id="unity-progress-bar-full"></div>
      </div>
      <div class="spinner"></div>
    </div>
  </div>
  
  <script>
    const buildUrl = "Build";
    const loaderUrl = buildUrl + "/Stand_on_the_right_color_Robby.loader.js";
    const config = {
      dataUrl: buildUrl + "/Stand_on_the_right_color_Robby.data.unityweb",
      frameworkUrl: buildUrl + "/Stand_on_the_right_color_Robby.framework.js.unityweb",
      codeUrl: buildUrl + "/Stand_on_the_right_color_Robby.wasm.unityweb",
      streamingAssetsUrl: "StreamingAssets",
      companyName: "oriken studio",
      productName: "Stand on the right color, Robby!",
      productVersion: "0.0.0.4"
    };

    const container = document.querySelector("#unity-container");
    const canvas = document.querySelector("#unity-canvas");
    const loadingBar = document.querySelector("#unity-loading-bar");
    const progressBarEmpty = document.querySelector("#unity-progress-bar-empty");
    const progressBarFull = document.querySelector("#unity-progress-bar-full");
    const spinner = document.querySelector('.spinner');

    // Disable right-click context menu
    document.addEventListener('contextmenu', event => event.preventDefault());

    // Define game provider functions
    window.gameProviderStart = function() {
      console.log("Mock: gameProviderStart called");
    };
    
    // Create a mock implementation of the Yandex SDK
    var YaGames = {
      init: function() {
        console.log("YaGames mock initialized");
        return Promise.resolve({
          // Game provider methods
          gameplayStart: function() {
            console.log("Mock: ysdk.gameplayStart called");
            return Promise.resolve();
          },
          gameplayStop: function() {
            console.log("Mock: ysdk.gameplayStop called");
            return Promise.resolve();
          },
          
          getPlayer: function() {
            return Promise.resolve({
              getName: function() { return "Player"; },
              getPhoto: function() { return null; },
              getUniqueID: function() { return "local-player"; },
              getMode: function() { return "resolved"; },
              setData: function() { return Promise.resolve(); },
              getData: function() { return Promise.resolve({}); }
            });
          },
          adv: {
            showFullscreenAdv: function() { console.log("Ad would show here"); },
            showRewardedVideo: function() { console.log("Rewarded video would show here"); }
          },
          environment: {
            i18n: { lang: "en" }
          }
        });
      }
    };
    
    window.ysdk = {
      // Game provider methods
      gameplayStart: function() {
        console.log("Mock: window.ysdk.gameplayStart called");
        return Promise.resolve();
      },
      gameplayStop: function() {
        console.log("Mock: window.ysdk.gameplayStop called");
        return Promise.resolve();
      },
      
      getPlayer: function() {
        return Promise.resolve({
          getName: function() { return "Player"; },
          getPhoto: function() { return null; },
          getUniqueID: function() { return "local-player"; },
          getMode: function() { return "resolved"; }
        });
      },
      
      adv: {
        showFullscreenAdv: function(options) {
          console.log("Mock: showFullscreenAdv called");
          if (options && options.callbacks) {
            if (options.callbacks.onOpen) options.callbacks.onOpen();
            setTimeout(() => {
              if (options.callbacks.onClose) options.callbacks.onClose(true);
            }, 300);
          }
        },
        showRewardedVideo: function(options) {
          console.log("Mock: showRewardedVideo called");
          if (options && options.callbacks) {
            if (options.callbacks.onOpen) options.callbacks.onOpen();
            setTimeout(() => {
              if (options.callbacks.onRewarded) options.callbacks.onRewarded();
              if (options.callbacks.onClose) options.callbacks.onClose();
            }, 300);
          }
        }
      }
    };

    // Load the Unity loader script
    const script = document.createElement("script");
    script.src = loaderUrl;
    script.onload = () => {
      // Create the Unity instance
      createUnityInstance(canvas, config, (progress) => {
        spinner.style.display = "none";
        progressBarEmpty.style.display = "";
        progressBarFull.style.width = `${100 * progress}%`;
      }).then((unityInstance) => {
        window.myGameInstance = unityInstance;
        loadingBar.style.display = "none";
        
        // Send mock player data to the game
        const authJson = {
          "playerAuth": "resolved",
          "playerName": "LocalPlayer",
          "playerId": "local-player-id",
          "playerPhoto": "null"
        };
        
        unityInstance.SendMessage('YandexGame', 'SetInitializationSDK', JSON.stringify(authJson));
      }).catch((message) => {
        alert(message);
      });
    };

    document.body.appendChild(script);
  </script>
</body>
</html>